events {
    worker_connections 1024;
}

http {
    upstream user_identity {
        server user_identity_service:8080;
    }

    upstream projects {
        server projects_service:8081;
    }

    upstream python_analyzer {
        server python_analyzer_service:8082;
    }

    upstream javascript_analyzer {
        server javascript_analyzer_service:8083;
    }

    upstream java_analyzer {
        server java_analyzer_service:8084;
    }

    upstream cpp_analyzer {
        server cpp_analyzer_service:8085;
    }

    upstream csharp_analyzer {
        server csharp_analyzer_service:8086;
    }

    upstream json_analyzer {
        server json_analyzer_service:8087;
    }

    upstream frontend {
        server frontend:80;
    }

    server {
        listen 80;
        server_name localhost;

        # Frontend
        location / {
            proxy_pass http://frontend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # User Identity Service
        location /api/users/ {
            proxy_pass http://user_identity;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Projects Service
        location /api/projects/ {
            proxy_pass http://projects;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # Analyzer Services
        location /api/analyzer/python {
            proxy_pass http://python_analyzer;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /api/analyzer/javascript {
            proxy_pass http://javascript_analyzer;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /api/analyzer/java {
            proxy_pass http://java_analyzer;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /api/analyzer/cpp {
            proxy_pass http://cpp_analyzer;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /api/analyzer/csharp {
            proxy_pass http://csharp_analyzer;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        location /api/analyzer/json {
            proxy_pass http://json_analyzer;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
    }
}

